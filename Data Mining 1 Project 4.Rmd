---
title: "Data Mining 1 Project 4"
author: "Ryan Canfield"
date: "2022-12-01"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(arules) # This package provides the infrastructure for representing, manipulating, and analyzing transaction data and patterns.
library(arulesViz) # This package is used for visualizing Association Rules and Frequent Itemsets. It extends the package arules. 
library(RColorBrewer) # This package provides color schemes for maps and other graphics.
library(dplyr) # Used for wrangling data.
library(readr) # Used to read in .csv files to view.
library(rJava) #This package is needed to run the rCBA package properly
library(rCBA)
```
### Project 4
### In this project, you will build association rules from a dataset of your choice using the a priori algorithm and the FP-algorithm. You will identify three association rules generated by the algorithms, and make recommendations to your client based on these rules. 


# Complete homework assignment 9 due Tuesday November 29, which includes these steps:
# 1. Choose a dataset. Some recommended datasets are provided below. However, you may choose any dataset that addresses the goals of the project, as long as the data can be converted into a transaction object in R.
```{r}
# Reading in the data found on kaggle https://www.kaggle.com/datasets/knightbearr/sales-product-data?resource=download
# Chose the month of December to look at sales because of holidays and potential high sales.
## Pre-Processing 
# Out of the six original columns: Order ID, Product, Quantity Ordered, Price Each, Order Date, Purchase Address, only used Order.ID and Product to convert to a transaction object.
# To do this I created a new .csv with just the desired columns because when I deleted the undesired columns from a copy of the .csv it was giving weird errors.

December_Sales <- read.csv("C:/Users/RRC/OneDrive/Documents/CLASSES/YEAR 3/Data Mining 1/Data Sets/Sales_by_Month/Sales_December_2019.csv")
head(December_Sales) # Previews the data and make sure pre-processing worked.

```

# 2. Identify who your client is based on the dataset you have chosen, and what problem you are trying to help them solve. For example, if you have chosen a dataset of grocery transactions, then your client might be the manager of a local branch of the grocery store chain, and the problem you are trying to help them solve is how to increase sales of certain items in their store. 
```{r}
# Identify who your client is:
# My Client could a general manager, store owner or any higher up of a electronic store like Best Buy or Radio Shack.

# What problem you will try to help them solve:
# The problem we are trying to help solve is how to sell less popular items like headphones and Monitors. Using association analysis we can see what items are frequently bought together, then according to the findings move said items closer together or prompt people to buy them using sales or deals. This will create more more revenue and make the store more money.

```

# 3. Use the arules() package in R to convert your data to a transaction object.
```{r}
# Converting my data to a transaction object using the read.transactions function.
December_Transactions <- read.transactions(file = "C:/Users/RRC/OneDrive/Documents/CLASSES/YEAR 3/Data Mining 1/Data Sets/Sales_by_Month/Sales_December3_2019.csv",
        header = TRUE, format = "single", sep = ",", cols = c("Order ID", "Product"))
summary(December_Transactions)

```

# 4. Generate a frequency plot of the top 10 items in your dataset. 
```{r}
# We can also look at a plot of the Top 10 items with the highest item frequency
arules::itemFrequencyPlot(December_Transactions, topN = 10, col = brewer.pal(10, 'Spectral'), 
                          main = 'Relative Item Frequency Plot', type = "relative", ylab = "Item Frequency (Relative)")
```


## Once your dataset is loaded properly as a transaction object and you have identified the client and the problem to solve:

## 5. Run the a priori algorithm to generate frequent itemsets. You should test a range of support and confidence thresholds, and provide some justification for your final choice of parameters. For example, you can use the arulesViz() package to visualize the performance of different support/confidence combinations, as we have done in class.
```{r}
# Running the apriori algorithm using the transaction dataset.
apriori.Rules <- apriori(December_Transactions, parameter = list(supp = 0.001, conf = 0.01, minlen = 2))

# Inspecting the rules generated
inspect(apriori.Rules)


# Plotting the rules
plot(apriori.Rules, method = "two-key plot")

#Now, plot an interactive graph; the darkness of the nodes indicates how high the lift is
# plot(apriori.Rules, method = "graph",  engine = "htmlwidget")
# need to comment this out even though it works to knit the file to a word doc

```

## 6. Run the FP-growth algorithm to generate frequent itemsets. As for the a priori algorithm, you should test a range of support and confidence thresholds, and provide some justification for your final choice of parameters.
```{r}
# Kind of works but not included anymore!
FP_growth.rules <- rCBA::fpgrowth(December_Sales, support = 0.001, confidence = 0.1, maxLength = 2, consequent = "Product")
inspect(FP_growth.rules)

```

## 7. For each algorithm, sort the association rules by “lift” and report the 10 rules with the highest lift. Comment on similarities and differences in the top 10 rules across the two algorithms.
```{r}
#Filter rules with confidence greater than 0.20
subRules <- apriori.Rules[quality(apriori.Rules)$lift > 0]

#Let's select 10 rules from subRules having the highest confidence
top10subRules <- head(subRules, n = 16, by = "lift")
inspect(top10subRules)

```

## 8. Choose three association rules that were identified. Describe the rules in detail. Which items that appear in these rules also appeared in your frequency plot of top 10 items? 
```{r}
## Association rule #1
#[1]	{Vareebadd Phone}	      =>	{USB-C Charging Cable} with a lift of	1.5264712	
#[2]	{USB-C Charging Cable}	=>	{Vareebadd Phone}	with a lift of 1.5264712

## Association rule #2
# [13]	{Google Phone}	              =>	{Bose SoundSport Headphones} with a lift of	0.5025476	
# [14]	{Bose SoundSport Headphones}	=>	{Google Phone} with a lift of	0.5025476	

## Association rule #1
# [15]	{Wired Headphones}     	=>	{USB-C Charging Cable} with a lift of	0.1017781	
# [16]	{USB-C Charging Cable}	=>	{Wired Headphones} with a lift of	0.1017781	


# For the first rule we have we have Vareebadd Phone (which is an Asian brand of smartphone) are associated with USB-C Charging Cable and vise versa. The lift this rule shares is a little above 1.5 which means they start to correlate, so when someone buys either a cable or phone they are likely to buy the other one as well.
# For the second rule we have a Google Phone which is associated with the Bose SoundSport Headphones and Bose SoundSport Headphones are associated with Google Phones. The lift this rule shares under 1 with a value of 0.503, so when someone buys either a headphones or a google phone they are likely to buy the other one as well.
# For the third rule we have Wired Headphones associate with USB-C Charging Cable with the reverse as well. The lift value is 0.102 which means that these to accessories are very likely to be bought together.	
# Out of the 6 items I chose for the association rules, only 3 are in the top 10 frequency plot. The three items are USB-C Charging Cable, Wired Headphones, and Bose SoundSport Headphones. They rank USB-C as the most frequent, wired headphones as the fifth most purchased and Bose headphones as the seventh most purchased.

```

## 9. Based on the three association rules you have chosen, develop recommendations that you would make to your client. Be as creative as possible! 
```{r}
# I would recommend to the client that if they by a VPhone and a USB-C Charging Cable (Rule 1) then to give a discount on different lengths of USB-C cable like a 3ft 6ft and 10ft cord bundle deal. Another recommendations would be to give them a deal on a wireless plan for the first few months either give them a few at a discount or a couple months free if they buy a certain level.

# I would recommend to the client that if they get a Google phone and the Bose headphones (Rule 2) to give them a spotify subscription for a discounted price. Another recommendation maybe could be to do something gym related since they are sports headphones. You could either do water bottles or gym memberships etc.

# I would recommend to the client that if they get a USB-C Charging Cable and Wired Headphones (Rule 3) to put discounts on other accessories key boards or mice. You could also move the monitors closer to these products since they are already popular. 

```


## There are two deliverables for this project:

## A 10-minute presentation in class on Thursday Dec 8, where you will summarize the work you have done on this project. 
## An R-markdown submission and 1-2 page written report identifying the client, describing the problem you are helping the client solve, and outlining your recommendations to the client based on the three association rules you chose. This final report will be due on Wednesday Dec 14 by 11am. Office hours will be held Mon Dec 12 and Tues Dec 13 to help students finalize their reports. 